<!DOCTYPE html>
<html style="padding:0; margin:0; width:100%; height:100%; overflow:hidden">
<head>
  <meta charset="utf-8">
  <script src="//player.ooyala.com/static/v4/stable/latest/core.min.js"></script>
  <script src="//player.ooyala.com/static/v4/stable/latest/video-plugin/main_html5.min.js"></script>
  <script src="//player.ooyala.com/static/v4/stable/latest/video-plugin/bit_wrapper.min.js"></script>
  <script src="//player.ooyala.com/static/v4/stable/latest/skin-plugin/html5-skin.min.js"></script>
  <link rel="stylesheet" href="//player.ooyala.com/static/v4/stable/latest/skin-plugin/html5-skin.min.css"/>
</head>

<body style="padding:0; margin:0; width:100%; height:100%; overflow:hidden">
  <div id='container' style='width:100%; height:100%;'></div>
  <script>
    function queryStringToJSON(qs) {
      var pairs = qs.split('&');
      var result = {};
      pairs.forEach(function(p) {
        var pair = p.split('=');
        var key = pair[0];
        var value = decodeURIComponent(pair[1] || '');
        if (value === "true") {
          value = true;
        } else if (value == "false") {
          value = false;
        } else if (!isNaN(parseFloat(value))) {
          value = parseFloat(value);
        } else if (value.match(/^\[.+\]$/)) {
          value = JSON.parse(value);
        } else if (value.match(/^\{.+\}$/)) {
          value = JSON.parse(value);
        } 

        if (result[key]) {
          if (Array.isArray(result[key])) {
            result[key].push(value);
          } else {
            result[key] = [result[key], value];
          }
        } else {
          result[key] = value;
        }
      });

      return JSON.parse(JSON.stringify(result));
    }
   
    var playerParams = queryStringToJSON(window.location.search.substring(1));
    var skin = {
      config: playerParams["skin.config"] || "",
      inline: {
        shareScreen: {
          embed: {
            source: "<iframe width='640' height='480' frameborder='0' allowfullscreen src='//player.ooyala.com/static/v4/stable/latest/skin-plugin/iframe.html?ec=<ASSET_ID>&pbid=<PLAYER_ID>&pcode=<PUBLISHER_ID>'></iframe>"
          }
        }
      }
    };
    playerParams["playerBrandingId"] = playerParams.pbid;
    playerParams["skin"] = skin;
    delete playerParams.pbid;
    delete playerParams["skin.config"];

    // Parse docUrl
    if (!playerParams.docUrl) {
      if (document.referrer) {
        playerParams["docUrl"] = document.referrer;
      } else {
        console.log("iframe.html - document.referrer was not set");
      }
    }

    OO.ready(function() {
      window.pp = OO.Player.create('container', playerParams.ec, playerParams);

      //Enable cross-iframe control
      window.addEventListener("message", function(evt){
        switch (evt.data) {
          case "play":
            pp.play();
            break;
          case "pause":
            pp.pause();
            break;
          case "mute":
            pp.setVolume(0);
            break;
          case "unmute":
            pp.setVolume(1);
            break;
        }
      });
    });
  </script>
</body>
</html>
